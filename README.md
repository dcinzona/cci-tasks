# cci-tasks

Custom python tasks for CumulusCI

## Development

To work on this project in a scratch org:

1. [Set up CumulusCI](https://cumulusci.readthedocs.io/en/latest/tutorial.html)
2. Run `cci flow run dev_org --org dev` to deploy this project.
3. Run `cci org browser dev` to open the org in your browser.

## Tasks

### `backup_data`

This task will take a backup of data based on an extract declaration file. The declaration file is a yaml file that contains the object name and the fields to extract. 

**Command Syntax**: `cci task run backup_data --org <org_name> --dataset <dataset_name>`

#### Options:
- `--org` (Required) - The name of the org to run the task against
- `--dataset` (Required) - The name of the dataset to use for the backup (this is the name of the folder where the backup will be stored)
- `--extraction-definition` (Optional) - The path to the extraction definition file. If not provided, the task will create one for Account
- `--preview` (Optional) - If provided, the task will only print the mapping definition generated by the extraction definition

#### Extraction Definition File
The extraction definition file accepts sObject API Names, Field API Names, and  groups like:
- `OBJECTS(ALL)` to extract all objects
- `OBJECTS(CUSTOM)` to extract all custom objects
- `OBJECTS(STANDARD)` to extract all standard objects
- `FIELDS( ALL | CUSTOM | STANDARD )` to extract fields matching the criteria

Depenting on the criteria, the task will identify dependencies and extract the related objects and fields. Manually defined objects and fields will always be extracted.
```yaml
# Example extraction definition file
extract:
    Account:
        fields: FIELDS(ALL) # Extract all fields on Account
    OBJECTS(CUSTOM): # Extract all custom objects with the defined fields below
        fields:
            - Id
            - Name
            - CreatedDate
            - LastModifiedDate
            - FIELDS(CUSTOM) # Extract all custom fields on the custom objects
```

This hasn't been *thoroughly* tested, so please use with caution.